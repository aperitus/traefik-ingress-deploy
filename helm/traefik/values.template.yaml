# Traefik values template (minimal, schema-compliant)
#
# Validate keys on your runner:
#   helm show values traefik/traefik --version <ver> | less
#
# Notes:
# - We keep the dashboard IngressRoute disabled; the workflow validates the dashboard/API via port-forward only.
# - We create a non-default IngressClass called "traefik" so app repos can opt-in per Ingress.
# - This template is rendered to /tmp/values.traefik.generated.yaml at runtime (no secret material).

deployment:
  imagePullSecrets:
    - name: "<IMAGE_PULL_SECRET_NAME>"

image:
  registry: "<REGISTRY_SERVER>"
  repository: "<TRAEFIK_IMAGE_REPOSITORY>"   # e.g. traefik/traefik (in your Nexus path)
  tag: "<TRAEFIK_IMAGE_TAG>"                 # optional; if empty, workflow removes this key (chart defaults apply)

ingressClass:
  enabled: true
  isDefaultClass: false
  name: "traefik"

providers:
  kubernetesIngress:
    enabled: true
  kubernetesCRD:
    enabled: true

# Dashboard enabled internally only; no IngressRoute exposure from this chart.
api:
  dashboard: true
  ingressRoute:
    dashboard:
      enabled: false
    healthcheck:
      enabled: false

# Internal load balancer service on AKS (Azure ILB)
service:
  enabled: true
  type: LoadBalancer
  annotations:
    service.beta.kubernetes.io/azure-load-balancer-internal: "true"
  spec: {}

# EntryPoints: web(80), websecure(443), traefik(8080)
# Chart schema expects expose to be an object (not a boolean).
ports:
  web:
    expose:
      default: true
    exposedPort: 80
  websecure:
    expose:
      default: true
    exposedPort: 443
  traefik:
    expose:
      default: false

# Force the watched ingress class names (important if you choose a non-default name).
additionalArguments:
  - "--providers.kubernetesingress.ingressclass=traefik"
  - "--providers.kubernetescrd.ingressclass=traefik"
